{"version":3,"sources":["pos.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"../pos.min.js","sourcesContent":["var in_stock = true\r\n\r\nfunction add_invoice_item(item) {\r\n  if (count == 1) {\r\n    spositems = {};\r\n  }\r\n  if (item == null) {\r\n    return;\r\n  }\r\n\r\n  var item_id = Settings.item_addition == 1 ? item.item_id : item.id;\r\n  if (spositems[item_id]) {\r\n    spositems[item_id].row.qty = parseFloat(spositems[item_id].row.qty) + parseFloat(item.row.qty || 1);\r\n  } else {\r\n    spositems[item_id] = item;\r\n  }\r\n\r\n  store('spositems', JSON.stringify(spositems));\r\n  loadItems();\r\n  return true;\r\n}\r\n\r\nfunction loadItems() {\r\n  if (count == 1) {\r\n    spositems = {};\r\n  }\r\n  if (get('spositems')) {\r\n    total = 0;\r\n    count = 1;\r\n    an = 1;\r\n    product_tax = 0;\r\n    invoice_tax = 0;\r\n    product_discount = 0;\r\n    order_discount = 0;\r\n    total_discount = 0;\r\n\r\n    $('#posTable tbody').empty();\r\n    var time = new Date().getTime() / 1000;\r\n    if (Settings.remote_printing != 1) {\r\n      var pos_customer = 'C: ' + $('#select2-spos_customer-container').text() + '\\n';\r\n      var hr = 'R: ' + $('#hold_ref').val() + '\\n';\r\n      var user = 'U: ' + username + '\\n';\r\n      var pos_curr_time = 'T: ' + date(Settings.dateformat + ' ' + Settings.timeformat, time) + '\\n';\r\n      var ob_info = pos_customer + hr + user + pos_curr_time + '\\n';\r\n      order_data.info = ob_info;\r\n      bill_data.info = ob_info;\r\n      var o_items = '';\r\n      var b_items = '';\r\n    } else {\r\n      $('#order_span').empty();\r\n      $('#bill_span').empty();\r\n      var style = '<style>.bb td, .bb th { border-bottom: 1px solid #DDD; }</style>';\r\n      var pos_head = '<span style=\"text-align:center;\"><h3>' + Settings.site_name + '</h3>';\r\n      // var pos_customer = ''; // remove this line and uncomment below to display customer\r\n      var pos_customer = '<h5>C: ' + $('#select2-spos_customer-container').text() + '</h5>';\r\n      var hr = '<h5>R: ' + $('#hold_ref').val() + '</h5>';\r\n      var user = '<h5>U: ' + username + '</h5>';\r\n      var pos_curr_time = '<h5>T: ' + date(Settings.dateformat + ' ' + Settings.timeformat, time) + '</h5>';\r\n      $('#order_span').prepend(style + pos_head + '<h4>' + lang.order + '</h4></span>' + pos_customer + hr + user + pos_curr_time);\r\n      $('#bill_span').prepend(style + pos_head + '<h4>' + lang.bill + '</h4></span>' + pos_customer + hr + user + pos_curr_time);\r\n      $('#order-table').empty();\r\n      $('#bill-table').empty();\r\n    }\r\n    spositems = JSON.parse(get('spositems'));\r\n\r\n    $.each(spositems, function () {\r\n      var item = this;\r\n      var item_id = Settings.item_addition == 1 ? item.item_id : item.id;\r\n      spositems[item_id] = item;\r\n\r\n      var product_id = item.row.id,\r\n        item_type = item.row.type,\r\n        item_tax_method = parseFloat(item.row.tax_method),\r\n        combo_items = item.combo_items,\r\n        item_qty = item.row.qty,\r\n        item_aqty = parseFloat(item.row.quantity),\r\n        item_type = item.row.type,\r\n        item_ds = item.row.discount,\r\n        item_code = item.row.code,\r\n        item_name = item.row.name.replace(/\"/g, '&#034;').replace(/'/g, '&#039;');\r\n      var unit_price = parseFloat(item.row.real_unit_price);\r\n      var net_price = unit_price;\r\n      var item_comment = item.row.comment;\r\n      // var item_was_ordered = item.row.ordered ? item.row.ordered : 0;\r\n      var item_was_ordered = 0;\r\n\r\n      var ds = item_ds ? item_ds : '0';\r\n      var item_discount = formatDecimal(ds);\r\n      if (ds.indexOf('%') !== -1) {\r\n        var pds = ds.split('%');\r\n        if (!isNaN(pds[0])) {\r\n          item_discount = formatDecimal(parseFloat((net_price * parseFloat(pds[0])) / 100), 4);\r\n        }\r\n      }\r\n      product_discount += formatDecimal(item_discount * item_qty, 4);\r\n      net_price = formatDecimal(net_price - item_discount, 4);\r\n\r\n      var pr_tax = parseFloat(item.row.tax),\r\n        pr_tax_val = 0;\r\n      if (pr_tax !== null && pr_tax != 0) {\r\n        if (item_tax_method == 0) {\r\n          pr_tax_val = inclusiveTax(net_price, pr_tax);\r\n          net_price -= pr_tax_val;\r\n          tax = lang.inclusive;\r\n        } else {\r\n          pr_tax_val = exlusiveTax(net_price, pr_tax);\r\n          tax = lang.exclusive;\r\n        }\r\n      }\r\n      product_tax += formatDecimal(pr_tax_val * item_qty, 4);\r\n\r\n      var row_no = new Date().getTime();\r\n      var newTr = $('<tr id=\"' + row_no + '\" class=\"' + item_id + '\" data-item-id=\"' + item_id + '\" data-id=\"' + item.row.id + '\"></tr>');\r\n      tr_html =\r\n        '<td><input name=\"product_id[]\" type=\"hidden\" class=\"rid\" value=\"' +\r\n        product_id +\r\n        '\"><input name=\"item_comment[]\" type=\"hidden\" class=\"ritem_comment\" value=\"' +\r\n        item_comment +\r\n        '\"><input name=\"product_code[]\" type=\"hidden\" value=\"' +\r\n        item.row.code +\r\n        '\"><input name=\"product_name[]\" type=\"hidden\" value=\"' +\r\n        item.row.name +\r\n        '\"><button type=\"button\" class=\"btn bg-purple btn-block btn-xs edit\" id=\"' +\r\n        row_no +\r\n        '\" data-item=\"' +\r\n        item_id +\r\n        '\"><span class=\"sname\" id=\"name_' +\r\n        row_no +\r\n        '\">' +\r\n        item_name +\r\n        ' (' +\r\n        item_code +\r\n        ')</span></button></td>';\r\n      // <input class=\"rprice\" name=\"net_price[]\" type=\"hidden\" id=\"price_' + row_no + '\" value=\"' + formatDecimal(item_price) + '\">\r\n      tr_html +=\r\n        '<td class=\"text-right\"><input class=\"realuprice\" name=\"real_unit_price[]\" type=\"hidden\" value=\"' +\r\n        item.row.real_unit_price +\r\n        '\"><input class=\"rdiscount\" name=\"product_discount[]\" type=\"hidden\" id=\"discount_' +\r\n        row_no +\r\n        '\" value=\"' +\r\n        ds +\r\n        '\"><span class=\"text-right sprice\" id=\"sprice_' +\r\n        row_no +\r\n        '\">' +\r\n        formatMoney(parseFloat(net_price) + parseFloat(pr_tax_val)) +\r\n        '</span></td>';\r\n      tr_html +=\r\n        '<td><input name=\"item_was_ordered[]\" type=\"hidden\" class=\"riwo\" value=\"' +\r\n        item_was_ordered +\r\n        '\"><input class=\"form-control input-qty kb-pad text-center rquantity\" name=\"quantity[]\" type=\"text\" value=\"' +\r\n        formatDecimal(item_qty) +\r\n        '\" data-id=\"' +\r\n        row_no +\r\n        '\" data-item=\"' +\r\n        item_id +\r\n        '\" id=\"quantity_' +\r\n        row_no +\r\n        '\" onClick=\"this.select();\"></td>';\r\n      tr_html +=\r\n        '<td class=\"text-right\"><span class=\"text-right ssubtotal\" id=\"subtotal_' +\r\n        row_no +\r\n        '\">' +\r\n        formatMoney((parseFloat(net_price) + parseFloat(pr_tax_val)) * parseFloat(item_qty)) +\r\n        '</span></td>';\r\n      tr_html += '<td class=\"text-center\"><i class=\"fa fa-trash-o tip pointer posdel\" id=\"' + row_no + '\" title=\"Remove\"></i></td>';\r\n      newTr.html(tr_html);\r\n      newTr.prependTo('#posTable');\r\n      total += formatDecimal((parseFloat(net_price) + parseFloat(pr_tax_val)) * parseFloat(item_qty), 4);\r\n      count += parseFloat(item_qty);\r\n      an++;\r\n      // $('#list-table-div').scrollTop(0);\r\n      var oitb = $('#list-table-div')[0].scrollHeight;\r\n      $('#list-table-div').slimScroll({ scrollTo: oitb });\r\n      if (item_type == 'standard' && item_qty > item_aqty) {\r\n        $('#' + row_no).addClass('danger');\r\n        $('#' + row_no)\r\n          .find('.edit')\r\n          .removeClass('bg-purple')\r\n          .addClass('btn-warning');\r\n      } else if (item_type == 'combo') {\r\n        if (combo_items === false) {\r\n          $('#' + row_no).addClass('danger');\r\n        } else {\r\n          $.each(combo_items, function () {\r\n            if (parseFloat(this.quantity) < parseFloat(this.qty) * item_qty) {\r\n              $('#' + row_no).addClass('danger');\r\n              $('#' + row_no)\r\n                .find('.edit')\r\n                .removeClass('bg-purple')\r\n                .addClass('btn-warning');\r\n            }\r\n          });\r\n        }\r\n      }\r\n\r\n      var comments = item_comment ? item_comment.split(/\\r?\\n/g) : [];\r\n      if (Settings.remote_printing != 1) {\r\n        b_items += '#' + (an - 1) + ' ' + item_name + ' (' + item_code + ')' + '\\n';\r\n        for (var i = 0, len = comments.length; i < len; i++) {\r\n          b_items += comments[i].length > 0 ? '   * ' + comments[i] + '\\n' : '';\r\n        }\r\n        b_items +=\r\n          printLine(\r\n            item_qty +\r\n              ' x ' +\r\n              formatMoney(parseFloat(net_price) + parseFloat(pr_tax_val)) +\r\n              ': ' +\r\n              formatMoney((parseFloat(net_price) + parseFloat(pr_tax_val)) * parseFloat(item_qty))\r\n          ) + '\\n';\r\n        o_items +=\r\n          printLine(\r\n            '#' + (an - 1) + ' ' + item_name + ' (' + item_code + '): [ ' + (item_was_ordered != 0 ? 'xxxx' : parseFloat(item_qty))\r\n          ) + ' ]\\n';\r\n        for (var i = 0, len = comments.length; i < len; i++) {\r\n          o_items += comments[i].length > 0 ? '   * ' + comments[i] + '\\n' : '';\r\n        }\r\n        o_items += '\\n';\r\n      } else {\r\n        var bprTr =\r\n          '<tr class=\"row_' +\r\n          item_id +\r\n          '\" data-item-id=\"' +\r\n          item_id +\r\n          '\"><td colspan=\"2\" style=\"border-bottom:0!important;\">#' +\r\n          (an - 1) +\r\n          ' ' +\r\n          (item_id == 0 ? item.row.name : item_name + ' (' + item_code + ')');\r\n        for (var i = 0, len = comments.length; i < len; i++) {\r\n          bprTr += comments[i] ? '<br> <b>*</b> <small>' + comments[i] + '</small>' : '';\r\n        }\r\n        bprTr += '</td></tr>';\r\n        bprTr +=\r\n          '<tr class=\"bb row_' +\r\n          item_id +\r\n          '\" data-item-id=\"' +\r\n          item_id +\r\n          '\"><td>(' +\r\n          item_qty +\r\n          ' x ' +\r\n          formatMoney(parseFloat(net_price) + parseFloat(pr_tax_val)) +\r\n          ')</td><td style=\"text-align:right;\">' +\r\n          formatMoney((parseFloat(net_price) + parseFloat(pr_tax_val)) * parseFloat(item_qty)) +\r\n          '</td></tr>';\r\n        var oprTr =\r\n          '<tr class=\"bb row_' + item_id + '\" data-item-id=\"' + item_id + '\"><td>#' + (an - 1) + ' ' + item_name + ' (' + item_code + ')';\r\n        for (var i = 0, len = comments.length; i < len; i++) {\r\n          oprTr += comments[i] ? '<br> <b>*</b> <small>' + comments[i] + '</small>' : '';\r\n        }\r\n        oprTr += '</td><td>[ ' + (item_was_ordered != 0 ? 'xxxx' : parseFloat(item_qty)) + ' ]</td></tr>';\r\n        $('#order-table').append(oprTr);\r\n        $('#bill-table').append(bprTr);\r\n      }\r\n    });\r\n\r\n    var ds = get('spos_discount') ? get('spos_discount') : $('#discount_val').val() ? $('#discount_val').val() : '0';\r\n    order_discount = parseFloat(ds);\r\n    if (ds.indexOf('%') !== -1) {\r\n      var pds = ds.split('%');\r\n      order_discount = parseFloat((total * parseFloat(pds[0])) / 100);\r\n    }\r\n\r\n    var ts = get('spos_tax') ? get('spos_tax') : $('#tax_val').val() ? $('#tax_val').val() : '0';\r\n    order_tax = parseFloat(ts);\r\n    if (ts.indexOf('%') !== -1) {\r\n      var pts = ts.split('%');\r\n      order_tax = ((total - order_discount) * parseFloat(pts[0])) / 100;\r\n    }\r\n\r\n    g_total = total - parseFloat(order_discount) + parseFloat(order_tax);\r\n    grand_total = formatMoney(g_total);\r\n    $('#ds_con').text('(' + formatMoney(product_discount) + ') ' + formatMoney(order_discount));\r\n    $('#ts_con').text(formatMoney(order_tax));\r\n    $('#total-payable').text(grand_total);\r\n    $('#total').text(formatMoney(total));\r\n    $('#count').text(an - 1 + ' (' + formatMoney(count - 1) + ')');\r\n\r\n    if (Settings.remote_printing != 1) {\r\n      order_data.items = o_items;\r\n      bill_data.items = b_items;\r\n      var b_totals = '';\r\n      b_totals += printLine(lang.total + ': ' + formatMoney(total)) + '\\n';\r\n      if (order_discount > 0 || product_discount > 0) {\r\n        b_totals += printLine(lang.discount + ': ' + formatMoney(order_discount + product_discount)) + '\\n';\r\n      }\r\n      if (order_tax != 0) {\r\n        b_totals += printLine(lang.order_tax + ': ' + formatMoney(order_tax)) + '\\n';\r\n      }\r\n      b_totals += printLine(lang.grand_total + ': ' + formatMoney(g_total)) + '\\n';\r\n      if (Settings.rounding != 0) {\r\n        round_total = roundNumber(g_total, parseInt(Settings.rounding));\r\n        var rounding = formatDecimal(round_total - g_total, 4);\r\n        b_totals += printLine(lang.rounding + ': ' + formatMoney(rounding)) + '\\n';\r\n        b_totals += printLine(lang.total_payable + ': ' + formatMoney(round_total)) + '\\n';\r\n      }\r\n      b_totals += '\\n' + lang.total_items + ': ' + (an - 1) + ' (' + (parseFloat(count) - 1) + ')' + '\\n';\r\n      bill_data.totals = b_totals;\r\n    } else {\r\n      var bill_totals = '';\r\n      bill_totals +=\r\n        '<tr class=\"bb\"><td>' +\r\n        lang.total_items +\r\n        '</td><td style=\"text-align:right;\">' +\r\n        (an - 1) +\r\n        ' (' +\r\n        (parseFloat(count) - 1) +\r\n        ')</td></tr>';\r\n      bill_totals += '<tr class=\"bb\"><td>' + lang.total + '</td><td style=\"text-align:right;\">' + formatMoney(total) + '</td></tr>';\r\n      if (order_discount > 0 || product_discount > 0) {\r\n        bill_totals +=\r\n          '<tr class=\"bb\"><td>' +\r\n          lang.discount +\r\n          '</td><td style=\"text-align:right;\">' +\r\n          formatMoney(order_discount + product_discount) +\r\n          '</td></tr>';\r\n      }\r\n      if (order_tax != 0) {\r\n        bill_totals +=\r\n          '<tr class=\"bb\"><td>' + lang.order_tax + '</td><td style=\"text-align:right;\">' + formatMoney(order_tax) + '</td></tr>';\r\n      }\r\n      bill_totals += '<tr class=\"bb\"><td>' + lang.grand_total + '</td><td style=\"text-align:right;\">' + formatMoney(g_total) + '</td></tr>';\r\n      if (Settings.rounding != 0) {\r\n        round_total = roundNumber(g_total, parseInt(Settings.rounding));\r\n        var rounding = formatDecimal(round_total - g_total, 4);\r\n        bill_totals += '<tr class=\"bb\"><td>' + lang.rounding + '</td><td style=\"text-align:right;\">' + formatMoney(rounding) + '</td></tr>';\r\n        bill_totals += '<tr><td>' + lang.total_payable + '</td><td style=\"text-align:right;\">' + formatMoney(round_total) + '</td></tr>';\r\n      }\r\n      bill_totals += '<tr><td colspan=\"2\" style=\"text-align:center;\">' + lang.merchant_copy + '</td></tr>';\r\n      $('#bill-total-table').empty();\r\n      $('#bill-total-table').append(bill_totals);\r\n    }\r\n\r\n    if (Settings.display_kb == 1) {\r\n      display_keyboards();\r\n    }\r\n    $('#add_item').focus();\r\n  }\r\n}\r\n\r\nfunction chr(i) {\r\n  return String.fromCharCode(i);\r\n}\r\n\r\n$(document).ready(function () {\r\n  $(document).on('click', '.no-results, #filter-suspended-sales', function (e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  });\r\n\r\n  $('#susModal').on('shown.bs.modal', function (e) {\r\n    $('#reference_note').focus();\r\n  });\r\n\r\n  $('#filter-categories').hideseek({\r\n    nodata: lang.no_match_found,\r\n  });\r\n\r\n  $(document).on('click', '.suspended_sales .dropdown-menu .header', function (e) {\r\n    e.stopPropagation();\r\n  });\r\n\r\n  $('#filter-suspended-sales').hideseek({\r\n    nodata: lang.no_match_found,\r\n  });\r\n\r\n  $('#suspended_sales').on('shown.bs.dropdown', function () {\r\n    $('#filter-suspended-sales').focus();\r\n  });\r\n\r\n  $(document).on('click', '#update-note', function () {\r\n    var n = $('#snote').val();\r\n    store('spos_note', n);\r\n    $('#note').val(n);\r\n    $('#noteModal').modal('hide');\r\n  });\r\n  /* =============================\r\n    Edit Item Modal\r\n    ============================= */\r\n\r\n  $('#posTable').on('click', '.edit', function () {\r\n    var row = $(this).closest('tr');\r\n    var id = row.attr('id');\r\n    var item_id = row.attr('data-item-id');\r\n    var item_rid = row.attr('data-id');\r\n    var item = spositems[item_id];\r\n    //var unit_price = parseFloat(item.row.real_unit_price);\r\n    var unit_price = formatDecimal(row.find('.realuprice').val());\r\n    var net_price = unit_price;\r\n    var ds = item.row.discount ? item.row.discount : '0';\r\n    item_discount = formatDecimal(parseFloat(ds));\r\n    if (ds.indexOf('%') !== -1) {\r\n      var pds = ds.split('%');\r\n      if (!isNaN(pds[0])) {\r\n        item_discount = formatDecimal((net_price * parseFloat(pds[0])) / 100);\r\n      }\r\n    }\r\n    net_price -= item_discount;\r\n    var pr_tax = parseFloat(item.row.tax),\r\n      pr_tax_val = 0,\r\n      tax = '';\r\n    if (pr_tax !== null && pr_tax != 0) {\r\n      if (parseFloat(item.row.tax_method) == 0) {\r\n        pr_tax_val = formatDecimal((net_price * parseFloat(pr_tax)) / (100 + parseFloat(pr_tax)));\r\n        net_price -= pr_tax_val;\r\n        tax = lang.inclusive;\r\n      } else {\r\n        pr_tax_val = formatDecimal((net_price * parseFloat(pr_tax)) / 100);\r\n        tax = lang.exclusive;\r\n      }\r\n    }\r\n\r\n    $('#proModalLabel').html('<a href=\"' + base_url + '/products/view/' + item_rid + '\" data-toggle=\"ajax\">' + item.label + '</a>');\r\n    $('#net_price').text(formatMoney(net_price));\r\n    $('#pro_tax').text(formatMoney(pr_tax_val));\r\n    $('#pro_tax_method').text('(' + tax + ')');\r\n    $('#row_id').val(row_id);\r\n    $('#item_id').val(item_id);\r\n    $('#nPrice').val(unit_price);\r\n    $('#nQuantity').val(item.row.qty);\r\n    $('#nDiscount').val(ds);\r\n    $('#nComment').val(item.row.comment);\r\n    $('#proModal').modal({ backdrop: 'static' });\r\n  });\r\n\r\n  $(document).on('change', '#nPrice, #nDiscount', function () {\r\n    var item_id = $('#item_id').val();\r\n    var unit_price = parseFloat($('#nPrice').val());\r\n    var net_price = unit_price;\r\n    var item = spositems[item_id];\r\n    var ds = $('#nDiscount').val() ? $('#nDiscount').val() : '0';\r\n    item_discount = formatDecimal(parseFloat(ds));\r\n    if (ds.indexOf('%') !== -1) {\r\n      var pds = ds.split('%');\r\n      if (!isNaN(pds[0])) {\r\n        item_discount = formatDecimal((unit_price * parseFloat(pds[0])) / 100);\r\n      }\r\n    }\r\n    net_price -= item_discount;\r\n    var pr_tax = parseFloat(item.row.tax),\r\n      pr_tax_val = 0;\r\n    if (pr_tax !== null && pr_tax != 0) {\r\n      if (parseFloat(item.row.tax_method) == 0) {\r\n        pr_tax_val = formatDecimal((net_price * parseFloat(pr_tax)) / (100 + parseFloat(pr_tax)));\r\n        net_price -= pr_tax_val;\r\n        tax = lang.inclusive;\r\n      } else {\r\n        pr_tax_val = formatDecimal((net_price * parseFloat(pr_tax)) / 100);\r\n        tax = lang.exclusive;\r\n      }\r\n    }\r\n\r\n    $('#net_price').text(formatMoney(net_price));\r\n    $('#pro_tax').text(formatMoney(pr_tax_val));\r\n  });\r\n\r\n  /* =============================\r\n    Edit Item Method\r\n    ============================= */\r\n  $(document).on('click', '#editItem', function () {\r\n    var item_id = $('#item_id').val();\r\n    var price = parseFloat($('#nPrice').val());\r\n    if (!is_valid_discount($('#nDiscount').val())) {\r\n      bootbox.alert(lang.unexpected_value);\r\n      return false;\r\n    }\r\n    (spositems[item_id].row.qty = parseFloat($('#nQuantity').val())),\r\n      (spositems[item_id].row.real_unit_price = price),\r\n      (spositems[item_id].row.comment = $('#nComment').val()),\r\n      (spositems[item_id].row.discount = $('#nDiscount').val() ? $('#nDiscount').val() : '0'),\r\n      localStorage.setItem('spositems', JSON.stringify(spositems));\r\n    $('#proModal').modal('hide');\r\n\r\n    loadItems();\r\n    return;\r\n  });\r\n\r\n  /* =============================\r\n    Row quantity change\r\n    ============================= */\r\n  $(document).on('change', '.rquantity', function () {\r\n    var row = $(this).closest('tr');\r\n    if (!is_numeric($(this).val()) || $(this).val() == 0) {\r\n      loadItems();\r\n      bootbox.alert(lang.unexpected_value);\r\n      return false;\r\n    }\r\n    var new_qty = parseFloat($(this).val()),\r\n      item_id = row.attr('data-item-id');\r\n    spositems[item_id].row.qty = new_qty;\r\n    localStorage.setItem('spositems', JSON.stringify(spositems));\r\n    loadItems();\r\n  });\r\n\r\n  $('#reset').click(function (e) {\r\n    if (count <= 1) {\r\n      return false;\r\n    }\r\n    if (protect_delete == 1) {\r\n      var boxd = bootbox.dialog({\r\n        title: lang.enter_pin_code,\r\n        closeButton: true,\r\n        message: '<input id=\"pos_pin\" name=\"pos_pin\" type=\"password\" placeholder=\"Pin Code\" class=\"form-control kb-pad\"> ',\r\n        buttons: {\r\n          danger: {\r\n            label: lang.close,\r\n            className: 'btn-default pull-left',\r\n            callback: function () {},\r\n          },\r\n          success: {\r\n            label: \"<i class='fa fa-tick'></i> \" + lang.delete,\r\n            className: 'btn-warning verify_pin',\r\n            callback: function () {\r\n              var pos_pin = md5($('#pos_pin').val());\r\n              if (pos_pin == Settings.pin_code) {\r\n                if (get('spositems')) {\r\n                  remove('spositems');\r\n                }\r\n                if (get('spos_tax')) {\r\n                  remove('spos_tax');\r\n                }\r\n                if (get('spos_discount')) {\r\n                  remove('spos_discount');\r\n                }\r\n                if (get('spos_customer')) {\r\n                  remove('spos_customer');\r\n                }\r\n                window.location.href = base_url + 'pos';\r\n              } else {\r\n                bootbox.alert(lang.wrong_pin);\r\n              }\r\n            },\r\n          },\r\n        },\r\n      });\r\n      boxd.on('shown.bs.modal', function () {\r\n        if (Settings.display_kb == 1) {\r\n          display_keyboards();\r\n        }\r\n        $('#pos_pin')\r\n          .focus()\r\n          .keypress(function (e) {\r\n            if (e.keyCode == 13) {\r\n              e.preventDefault();\r\n              $('.verify_pin').trigger('click');\r\n              return false;\r\n            }\r\n          });\r\n      });\r\n    } else {\r\n      bootbox.confirm(lang.r_u_sure, function (result) {\r\n        if (result) {\r\n          if (get('spositems')) {\r\n            remove('spositems');\r\n          }\r\n          if (get('spos_tax')) {\r\n            remove('spos_tax');\r\n          }\r\n          if (get('spos_discount')) {\r\n            remove('spos_discount');\r\n          }\r\n          if (get('spos_customer')) {\r\n            remove('spos_customer');\r\n          }\r\n          window.location.href = base_url + 'pos';\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n  $('#print_order').click(function (e) {\r\n    e.preventDefault();\r\n    if (count <= 1) {\r\n      bootbox.alert(lang.please_add_product);\r\n    } else {\r\n      if (Settings.remote_printing == 0) {\r\n        $('#order-data').show();\r\n        if (Settings.print_img == 1) {\r\n          $('#preo').html(\r\n            '<pre style=\"background:#FFF;font-size:18px;margin:0;border:0;color:#000 !important;\">' +\r\n              order_data.info +\r\n              order_data.items +\r\n              '</pre>'\r\n          );\r\n          var element = $('#order-data').get(0);\r\n          html2canvas(element, { scrollY: 0, scale: 1.3 }).then(function (canvas) {\r\n            var img = canvas.toDataURL().split(',')[1];\r\n            $.post(base_url + 'pos/receipt_img', {\r\n              img: img,\r\n              spos_token: csrf_hash,\r\n            });\r\n            // return Canvas2Image.saveAsPNG(canvas);\r\n          });\r\n        } else {\r\n          var form = $('#pos-sale-form').serialize();\r\n          $.post(base_url + 'pos/p/order', form);\r\n        }\r\n      } else {\r\n        printOrder(order_data);\r\n      }\r\n    }\r\n    setTimeout(function () {\r\n      $('#order-data').hide();\r\n    }, 500);\r\n    return false;\r\n  });\r\n\r\n  $('#print_bill').click(function (e) {\r\n    e.preventDefault();\r\n    if (count <= 1) {\r\n      bootbox.alert(lang.please_add_product);\r\n    } else {\r\n      if (Settings.remote_printing == 0) {\r\n        $('#bill-data').show();\r\n        if (Settings.print_img == 1) {\r\n          $('#preb').html(\r\n            '<pre style=\"background:#FFF;font-size:18px;margin:0;border:0;color:#000 !important;\">' +\r\n              bill_data.info +\r\n              bill_data.items +\r\n              '\\n' +\r\n              bill_data.totals +\r\n              '</pre>'\r\n          );\r\n          var element = $('#bill-data').get(0);\r\n          html2canvas(element, { scrollY: 0, scale: 1.3 }).then(function (canvas) {\r\n            var img = canvas.toDataURL().split(',')[1];\r\n            $.post(base_url + 'pos/receipt_img', {\r\n              img: img,\r\n              spos_token: csrf_hash,\r\n            });\r\n            // return Canvas2Image.saveAsPNG(canvas);\r\n          });\r\n        } else {\r\n          var form = $('#pos-sale-form').serialize();\r\n          $.post(base_url + 'pos/p/bill', form);\r\n        }\r\n      } else {\r\n        printBill(bill_data);\r\n      }\r\n    }\r\n    setTimeout(function () {\r\n      $('#bill-data').hide();\r\n    }, 500);\r\n    return false;\r\n  });\r\n\r\n  $('#updateDiscount').click(function () {\r\n    var ds = $('#get_ds').val() ? $('#get_ds').val() : '0';\r\n    var apply_to = $('input[name=apply_to]:checked').val();\r\n    if (ds.length != 0) {\r\n      if (apply_to == 'order') {\r\n        $('#discount_val').val(ds);\r\n        store('spos_discount', ds);\r\n        if (ds.indexOf('%') !== -1) {\r\n          var pds = ds.split('%');\r\n\r\n          order_discount = (total * parseFloat(pds[0])) / 100;\r\n          order_tax = calTax();\r\n          var g_total = total + order_tax - order_discount;\r\n          grand_total = parseFloat(g_total);\r\n          $('#ds_con').text('(' + formatMoney(product_discount) + ') ' + formatMoney(order_discount));\r\n          $('#total-payable').text(formatMoney(grand_total));\r\n        } else {\r\n          order_discount = ds;\r\n          order_tax = calTax();\r\n          var g_total = total + order_tax - parseFloat(order_discount);\r\n          grand_total = parseFloat(g_total);\r\n          $('#ds_con').text('(' + formatMoney(product_discount) + ') ' + formatMoney(order_discount));\r\n          $('#total-payable').text(formatMoney(grand_total));\r\n        }\r\n      } else if (apply_to == 'products') {\r\n        var items = {};\r\n        spositems = JSON.parse(get('spositems'));\r\n        $.each(spositems, function () {\r\n          this.row.discount = ds;\r\n        });\r\n        store('spositems', JSON.stringify(spositems));\r\n      }\r\n      loadItems();\r\n      $('#dsModal').modal('hide');\r\n    }\r\n  });\r\n\r\n  $('#add_discount').click(function () {\r\n    var dval = $('#discount_val').val();\r\n    $('#get_ds').val(dval);\r\n    $('#dsModal').modal({ backdrop: 'static' });\r\n    return false;\r\n  });\r\n  $('#dsModal').on('shown.bs.modal', function () {\r\n    $('#get_ds').focusToEnd();\r\n  });\r\n\r\n  $('#updateTax').click(function () {\r\n    var ts = $('#get_ts').val();\r\n    order_tax = 0;\r\n    if (ts.length != 0) {\r\n      $('#tax_val').val(ts);\r\n      store('spos_tax', ts);\r\n      if (ts.indexOf('%') !== -1) {\r\n        var pts = ts.split('%');\r\n        if (!isNaN(pts[0])) {\r\n          order_tax = ((total - order_discount) * parseFloat(pts[0])) / 100;\r\n          var g_total = total + order_tax - order_discount;\r\n          grand_total = parseFloat(g_total);\r\n          $('#ts_con').text(formatMoney(order_tax));\r\n          $('#total-payable').text(formatMoney(grand_total));\r\n        } else {\r\n          $('#get_ts').val('0');\r\n          $('#tax_val').val('0');\r\n          var g_total = total - order_discount;\r\n          grand_total = parseFloat(g_total);\r\n          $('#ts_con').text('0');\r\n          $('#total-payable').text(formatMoney(grand_total));\r\n        }\r\n      } else {\r\n        if (!isNaN(ts) && ts != 0) {\r\n          order_tax = ts;\r\n          var g_total = total + parseFloat(ts) - order_discount;\r\n          grand_total = parseFloat(g_total);\r\n          $('#ts_con').text(formatMoney(order_tax));\r\n          $('#total-payable').text(formatMoney(grand_total));\r\n        } else {\r\n          $('#get_ts').val('0');\r\n          $('#tax_val').val('0');\r\n          var g_total = total - order_discount;\r\n          grand_total = parseFloat(g_total);\r\n          $('#ts_con').text('0');\r\n          $('#total-payable').text(formatMoney(grand_total));\r\n        }\r\n      }\r\n      $('#tsModal').modal('hide');\r\n    }\r\n  });\r\n\r\n  $('#add_tax').click(function () {\r\n    var tval = $('#tax_val').val();\r\n    $('#get_ts').val(tval);\r\n    $('#tsModal').modal({ backdrop: 'static' });\r\n    return false;\r\n  });\r\n  $('#tsModal').on('shown.bs.modal', function () {\r\n    $('#get_ts').focusToEnd();\r\n  });\r\n  $('#noteModal').on('shown.bs.modal', function () {\r\n    $('#snote').focusToEnd();\r\n  });\r\n\r\n  $(document).on('click', '.product', function (e) {\r\n    code = $(this).val();\r\n    $.ajax({\r\n      type: 'get',\r\n      url: base_url + 'pos/get_product/' + code,\r\n      dataType: 'json',\r\n      success: function (data) {\r\n        if (data !== null) {\r\n          add_invoice_item(data);\r\n        } else {\r\n          bootbox.alert(lang.no_match_found);\r\n        }\r\n      },\r\n    });\r\n  });\r\n\r\n  function execAjaxProducts(reset){\r\n    let data = { \r\n      category_id: cat_id, \r\n      in_stock: in_stock ? 1 : 0, \r\n      per_page: p_page,\r\n      tcp: 1\r\n    }\r\n\r\n    if(!data.category_id){\r\n      delete data.category_id\r\n    }\r\n\r\n    if(reset){\r\n      delete data.per_page\r\n      p_page = 'n'\r\n    }\r\n\r\n    $.ajax({\r\n      type: 'get',\r\n      url: base_url + 'pos/ajaxproducts',\r\n      data,\r\n      dataType: 'json',\r\n      success: function (data) {\r\n        tcp = data.tcp;\r\n        $('.items').html(data.products);\r\n        nav_pointer();\r\n      },\r\n    });\r\n  }\r\n\r\n  $(document).on('click', '.category', function () {\r\n    var cid = $(this).attr('id');\r\n    if (cat_id != cid) {\r\n      cat_id = cid;\r\n      $('.category').removeClass('active');\r\n      $('#' + cat_id).addClass('active');\r\n\r\n      execAjaxProducts(true)\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $('#categorias_filter').change(function (e) {\r\n    var cid = $(this).val();\r\n    cat_id = cid;\r\n    execAjaxProducts(true)\r\n  })\r\n\r\n  $('#existing').change(function(e){\r\n    in_stock = $(this).prop('checked')\r\n    execAjaxProducts(true)\r\n  })\r\n\r\n  $('#category-' + cat_id).addClass('active');\r\n\r\n  $('#next').click(function () {\r\n    if (p_page == 'n') {\r\n      p_page = 0;\r\n    }\r\n    p_page += pro_limit;\r\n    if (tcp >= pro_limit && p_page < tcp) {\r\n      execAjaxProducts(false)\r\n    } else {\r\n      p_page -= pro_limit;\r\n    }\r\n  });\r\n\r\n  $('#previous').click(function () {\r\n    if (p_page == 'n') {\r\n      p_page = 0;\r\n    }\r\n    if (p_page != 0) {\r\n      p_page -= pro_limit;\r\n      if (p_page == 0) {\r\n        p_page = 'n';\r\n      }\r\n      execAjaxProducts(false)\r\n    }\r\n  });\r\n\r\n  $('#add_item').autocomplete({\r\n    source: base_url + 'pos/suggestions',\r\n    minLength: 1,\r\n    autoFocus: false,\r\n    delay: 200,\r\n    response: function (event, ui) {\r\n      if ($(this).val().length >= 16 && ui.content[0] && ui.content[0].id == 0) {\r\n        bootbox.alert(lang.no_match_found, function () {\r\n          $('#add_item').focus();\r\n        });\r\n        $(this).val('');\r\n      } else if (ui.content.length == 1 && ui.content[0] && ui.content[0].id != 0) {\r\n        ui.item = ui.content[0];\r\n        $(this).data('ui-autocomplete')._trigger('select', 'autocompleteselect', ui);\r\n        $(this).autocomplete('close');\r\n      } else if (ui.content.length == 1 && ui.content[0] && ui.content[0].id == 0) {\r\n        bootbox.alert(lang.no_match_found, function () {\r\n          $('#add_item').focus();\r\n        });\r\n        $(this).val('');\r\n      }\r\n    },\r\n    select: function (event, ui) {\r\n      event.preventDefault();\r\n      if (ui.item.id !== 0) {\r\n        var row = add_invoice_item(ui.item);\r\n        if (row) $(this).val('');\r\n      } else {\r\n        bootbox.alert(lang.no_match_found);\r\n      }\r\n    },\r\n  });\r\n\r\n  $('#add_item').bind('keypress', function (e) {\r\n    if (e.keyCode == 13) {\r\n      e.preventDefault();\r\n      $(this).autocomplete('search');\r\n    }\r\n  });\r\n\r\n  $('#add_item').focus();\r\n  $('#gccard_no').inputmask('9999 9999 9999 9999');\r\n  $('#gift_card_no').inputmask('9999 9999 9999 9999');\r\n  $('#gcexpiry').inputmask('yyyy-mm-dd', { placeholder: 'yyyy-mm-dd' });\r\n  $('#genNo').click(function () {\r\n    var no = generateCardNo();\r\n    $(this).parent().parent('.input-group').children('input').val(no);\r\n    return false;\r\n  });\r\n\r\n  $(document).on('click', '#sellGiftCard', function (e) {\r\n    if (count == 1) {\r\n      spositems = {};\r\n    }\r\n    $('#gcModal').modal({ backdrop: 'static' });\r\n  });\r\n\r\n  $(document).on('click', '#addGiftCard', function (e) {\r\n    var mid = 0,\r\n      gccode = $('#gccard_no').val(),\r\n      gcname = $('#gcname').val(),\r\n      gcvalue = $('#gcvalue').val(),\r\n      gcprice = parseFloat($('#gcprice').val());\r\n    gcexpiry = $('#gcexpiry').val();\r\n    if (gccode == '' || gcvalue == '' || gcprice == '' || gcvalue == 0 || gcprice == 0) {\r\n      $('#gcerror').text(lang.file_required_fields);\r\n      $('.gcerror-con').show();\r\n      return false;\r\n    }\r\n    var gc_data = new Array();\r\n    gc_data[0] = gccode;\r\n    gc_data[1] = gcvalue;\r\n    gc_data[2] = gcexpiry;\r\n\r\n    $.ajax({\r\n      type: 'get',\r\n      url: base_url + 'gift_cards/sell_gift_card',\r\n      dataType: 'json',\r\n      data: { gcdata: gc_data },\r\n      success: function (data) {\r\n        if (data.result === 'success') {\r\n          spositems[mid] = {\r\n            id: mid,\r\n            item_id: mid,\r\n            label: gcname + ' (' + gccode + ')',\r\n            row: {\r\n              id: mid,\r\n              code: gccode,\r\n              name: gcname,\r\n              quantity: 1,\r\n              price: gcprice,\r\n              real_unit_price: gcprice,\r\n              tax: 0,\r\n              qty: 1,\r\n              type: 'manual',\r\n              discount: '0',\r\n              comment: '',\r\n            },\r\n          };\r\n          store('spositems', JSON.stringify(spositems));\r\n          loadItems();\r\n          $('#gcModal').modal('hide');\r\n          $('#gccard_no').val('');\r\n          $('#gcvalue').val('');\r\n          $('#gcprice').val('');\r\n        } else {\r\n          $('#gcerror').text(data.message);\r\n          $('.gcerror-con').show();\r\n        }\r\n      },\r\n    });\r\n  });\r\n\r\n  // $('#opModal').bind().on('click', 'a', function(){\r\n  //     var pg = $.url($(this).attr(\"href\")).param(\"per_page\");\r\n  //     $.get( base_url+'pos/ob_page&per_page='+pg, function( data ) {\r\n  //         $( \".html_con\" ).html( data.pd );\r\n  //         $( \".page_con\" ).html( data.page );\r\n  //     }, \"json\");\r\n\r\n  //     return false;\r\n  // });\r\n\r\n  var pwacc = false;\r\n  $(document).on('click', '.posdel', function () {\r\n    var row = $(this).closest('tr');\r\n    var item_id = row.attr('data-item-id');\r\n    if (protect_delete == 1) {\r\n      var boxd = bootbox.dialog({\r\n        title: lang.enter_pin_code,\r\n        closeButton: true,\r\n        message: '<input id=\"pos_pin\" name=\"pos_pin\" type=\"password\" placeholder=\"Pin Code\" class=\"form-control kb-pad\"> ',\r\n        buttons: {\r\n          danger: {\r\n            label: lang.close,\r\n            className: 'btn-default pull-left',\r\n            callback: function () {},\r\n          },\r\n          success: {\r\n            label: \"<i class='fa fa-tick'></i> \" + lang.delete,\r\n            className: 'btn-warning verify_pin',\r\n            callback: function () {\r\n              var pos_pin = md5($('#pos_pin').val());\r\n              if (pos_pin == Settings.pin_code) {\r\n                delete spositems[item_id];\r\n                row.remove();\r\n                if (spositems.hasOwnProperty(item_id)) {\r\n                } else {\r\n                  localStorage.setItem('spositems', JSON.stringify(spositems));\r\n                  loadItems();\r\n                }\r\n              } else {\r\n                bootbox.alert(lang.wrong_pin);\r\n              }\r\n            },\r\n          },\r\n        },\r\n      });\r\n      boxd.on('shown.bs.modal', function () {\r\n        if (Settings.display_kb == 1) {\r\n          display_keyboards();\r\n        }\r\n        $('#pos_pin')\r\n          .focus()\r\n          .keypress(function (e) {\r\n            if (e.keyCode == 13) {\r\n              e.preventDefault();\r\n              $('.verify_pin').trigger('click');\r\n              return false;\r\n            }\r\n          });\r\n      });\r\n    } else {\r\n      delete spositems[item_id];\r\n      row.remove();\r\n      if (spositems.hasOwnProperty(item_id)) {\r\n      } else {\r\n        localStorage.setItem('spositems', JSON.stringify(spositems));\r\n        loadItems();\r\n      }\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $('#suspend').click(function () {\r\n    if (count <= 1) {\r\n      bootbox.alert(lang.please_add_product);\r\n      return false;\r\n    } else {\r\n      $('#susModal').modal({ backdrop: 'static' });\r\n    }\r\n  });\r\n\r\n  $('#suspend_sale').click(function () {\r\n    ref = $('#reference_note').val();\r\n    if (!ref || ref == '') {\r\n      bootbox.alert(lang.type_reference_note);\r\n      return false;\r\n    } else {\r\n      suspend = $('<span></span>');\r\n      if (sid !== 0) {\r\n        suspend.html(\r\n          '<input type=\"hidden\" name=\"delete_id\" value=\"' +\r\n            sid +\r\n            '\" /><input type=\"hidden\" name=\"suspend\" value=\"yes\" /><input type=\"hidden\" name=\"suspend_note\" value=\"' +\r\n            ref +\r\n            '\" />'\r\n        );\r\n      } else {\r\n        suspend.html('<input type=\"hidden\" name=\"suspend\" value=\"yes\" /><input type=\"hidden\" name=\"suspend_note\" value=\"' + ref + '\" />');\r\n      }\r\n      suspend.appendTo('#hidesuspend');\r\n      $('#pos-sale-form').submit();\r\n    }\r\n  });\r\n\r\n  $('#payment').click(function () {\r\n    if (count <= 1) {\r\n      bootbox.alert(lang.please_add_product);\r\n      return false;\r\n    } else {\r\n      if (sid) {\r\n        suspend = $('<span></span>');\r\n        suspend.html('<input type=\"hidden\" name=\"delete_id\" value=\"' + sid + '\" />');\r\n        suspend.appendTo('#hidesuspend');\r\n      }\r\n\r\n      gtotal = formatDecimal(total - order_discount + order_tax);\r\n      if (Settings.rounding != 0) {\r\n        round_total = roundNumber(gtotal, parseInt(Settings.rounding));\r\n        var rounding = formatDecimal(round_total - gtotal);\r\n        $('#twt').text(formatMoney(round_total) + ' (' + formatMoney(rounding) + ')');\r\n        $('#quick-payable').text(round_total);\r\n      } else {\r\n        $('#twt').text(formatMoney(gtotal));\r\n        $('#quick-payable').text(gtotal);\r\n      }\r\n      $('#item_count').text(an - 1 + ' (' + (count - 1) + ')');\r\n      $('#order_quantity').val(count - 1);\r\n      $('#order_items').val(an - 1);\r\n      $('#balance').text('0.00');\r\n      $('#payModal').modal({ backdrop: 'static' });\r\n    }\r\n  });\r\n  $('#payModal').on('shown.bs.modal', function (e) {\r\n    $('#amount').focus().val(0);\r\n    $('#quick-payable').click();\r\n  });\r\n  $('#payModal').on('hidden.bs.modal', function (e) {\r\n    $('#amount').val('').change();\r\n  });\r\n\r\n  $('#amount').change(function (e) {\r\n    var total_paying = $('.amount').val();\r\n    $('#total_paying').text(formatMoney(total_paying));\r\n    if (Settings.rounding != 0) {\r\n      $('#balance').text(formatMoney(total_paying - round_total));\r\n      $('#balance_val').val(formatDecimal(total_paying - round_total));\r\n      total_paid = total_paying;\r\n      grand_total = round_total;\r\n    } else {\r\n      $('#balance').text(formatMoney(total_paying - gtotal));\r\n      $('#balance_val').val(formatDecimal(total_paying - gtotal));\r\n      total_paid = total_paying;\r\n      grand_total = gtotal;\r\n    }\r\n  });\r\n\r\n  $('#add-customer').click(function () {\r\n    $('#customerModal').modal({ backdrop: 'static' });\r\n  });\r\n\r\n  $('#payModal').on('keypress', function (e) {\r\n    console.log(e.target.type);\r\n    if (e.which == 13 && e.target.type != 'textarea') {\r\n      $('#submit-sale').focus();\r\n      setTimeout(function () {\r\n        $('#submit-sale').click();\r\n      }, 250);\r\n    }\r\n  });\r\n\r\n  var nextinput = 0;\r\n  var total_cantidad = 0.0;\r\n  var metodos = [];\r\n  var cantidad = [];\r\n  var bancos = [];\r\n\r\n  const multiply = function() {\r\n    console.log(\"sdsd\");\r\n  }\r\n\r\n  $( \"body\" ).delegate( \".pago\", \"change\", function(e) {\r\n    id=e.target.id\r\n    var idd = id.split('_');\r\n    if(e.target.value == \"CC\"){\r\n      $(\"#banco_\"+idd[1]).css({ \"visibility\": \"\"});\r\n    } else {\r\n      $(\"#banco_\"+idd[1]).css({ \"visibility\": \"hidden \"});\r\n    }\r\n    \r\n  });\r\n\r\n  $('#payModal').on('click', '#add_payment', function () {      \r\n      $(\"#remove_payment\").css(\"display\", \"block\");\r\n      campo = `\r\n          <li style=\"margin-top:5px; list-style-type: none; margin-left:20px\">\r\n            <select id=\"metodo_${nextinput}\" class=\"form-control paid_by select2 pago\" style=\"width:35%; display:inline-block\">\r\n                <option value=\"seleccione\">Seleccione una opción</option>\r\n                <option value=\"cash\">Efectivo</option>\r\n                <option value=\"CC\">Tarjeta de crédito o débito</option>\r\n            </select>\r\n            <input placeholder=\"Cantidad\" style=\"margin-left:3px;width:25%; display:inline-block\" class=\"form-control\" type=\"text\" size=\"20\" id=\"cantidad_${nextinput}\" name=\"campo_' + ${nextinput} + '\"; />\r\n            <select id=\"banco_${nextinput}\" class=\"form-control paid_by select2 bank\" style=\"width:35%; display:inline-block;visibility:hidden\">\r\n                <option value=\"seleccione\">Seleccione una opción</option>\r\n                <option value=\"BBVA\">BBVA</option>\r\n                <option value=\"Santander\">Santander</option>\r\n                <option value=\"Banamex\">Banamex</option>\r\n                <option value=\"Banregio\">Banregio</option>\r\n                <option value=\"Bancoppel\">Bancoppel</option>\r\n                <option value=\"otros\">Otros</option>\r\n            </select>\r\n          </li>\r\n      `;\r\n      $(\"#campos\").append(campo);\r\n      nextinput++;\r\n  });\r\n\r\n  $(\"#remove_payment\").click(function () {\r\n    let remover = nextinput-1\r\n    $(\"#metodo_\" + remover).remove();\r\n    $(\"#cantidad_\" + remover).remove();\r\n    $(\"#banco_\" + remover).remove();\r\n    nextinput--;\r\n\r\n    if(nextinput==0){\r\n      $(\"#remove_payment\").css(\"display\", \"none\");\r\n        return false;\r\n     }   \r\n\r\n  });\r\n\r\n  $('#payModal').on('change', '#paid_by', function () {\r\n    $('#clear-cash-notes').click();\r\n    $('#amount').val(grand_total);\r\n    var p_val = $(this).val();\r\n    $('#paid_by_val').val(p_val);\r\n    var gtotal = formatDecimal(total - order_discount + order_tax);\r\n    if (Settings.rounding != 0) {\r\n      var rounded_total = formatDecimal(roundNumber(gtotal, parseInt(Settings.rounding)));\r\n    } else {\r\n      var rounded_total = formatDecimal(gtotal);\r\n    }\r\n    $('#rpaidby').val(p_val);\r\n    if (p_val == 'gift_card') {\r\n      $('.gc').slideDown();\r\n      $('.ngc').slideUp('fast');\r\n      setTimeout(function () {\r\n        $('#gift_card_no').focus();\r\n      }, 10);\r\n      $('#amount').attr('readonly', true);\r\n    } else {\r\n      $('.ngc').slideDown();\r\n      $('.gc').slideUp('fast');\r\n      $('#gc_details').html('');\r\n      $('#amount').attr('readonly', false);\r\n    }\r\n    if (p_val == 'cash' || p_val == 'other') {\r\n      var nextinput = 0;\r\n      nextinput++;\r\n      campo = '<li id=\"rut'+nextinput+'\">Campo:<input type=\"text\" size=\"20\" id=\"campo' + nextinput + '\"&nbsp; name=\"campo' + nextinput + '\"&nbsp; /></li>';\r\n      $(\"#campos\").append(campo);\r\n\r\n      /* $('.pcash').slideDown();\r\n      $('.pcheque').slideUp('fast');\r\n      $('.pcc').slideUp('fast'); */\r\n      setTimeout(function () {\r\n        $('#amount').focus();\r\n      }, 10);\r\n    } else if (p_val == 'CC' || p_val == 'stripe') {\r\n      $('.pcc').slideDown();\r\n      $('.pcheque').slideUp('fast');\r\n      $('.pcash').slideUp('fast');\r\n      $('#amount').val(rounded_total);\r\n      setTimeout(function () {\r\n        $('#swipe').val('').focus();\r\n      }, 10);\r\n    } else if (p_val == 'cheque') {\r\n      $('.pcheque').slideDown();\r\n      $('.pcc').slideUp('fast');\r\n      $('.pcash').slideUp('fast');\r\n      $('#amount').val(rounded_total);\r\n      setTimeout(function () {\r\n        $('#cheque_no').focus();\r\n      }, 10);\r\n    } else {\r\n      $('.pcheque').hide();\r\n      $('.pcc').hide();\r\n      $('.pcash').hide();\r\n    }\r\n  });\r\n\r\n  $(document).on('change', '.gift_card_no', function () {\r\n    var cn = $(this).val() ? $(this).val() : '';\r\n    if (cn != '') {\r\n      $.ajax({\r\n        type: 'get',\r\n        async: false,\r\n        url: base_url + 'pos/validate_gift_card/' + cn,\r\n        dataType: 'json',\r\n        success: function (data) {\r\n          if (data === false || data.balance < 0) {\r\n            $('#gift_card_no').parent('.form-group').addClass('has-error');\r\n            bootbox.alert(lang.incorrect_gift_card);\r\n          } else {\r\n            $('#gc_details').html(\r\n              lang.card_no + ': ' + data.card_no + '<br>' + lang.value + ': ' + data.value + ' - ' + lang.balance + ': ' + data.balance\r\n            );\r\n            $('#gift_card_no').parent('.form-group').removeClass('has-error');\r\n            var paying = gtotal > data.balance ? data.balance : gtotal;\r\n            $('#amount_val').val(paying);\r\n            $('#amount').val(paying);\r\n          }\r\n        },\r\n      });\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $(document).on('click', '#quick-payable', function () {\r\n    $('#clear-cash-notes').click();\r\n    $(this).append('<span class=\"badge\">1</span>');\r\n    $('#amount').val(grand_total);\r\n  });\r\n\r\n  $(document).on('click', '.quick-cash', function () {\r\n    if ($('#quick-payable').find('span.badge').length) {\r\n      $('#clear-cash-notes').click();\r\n    }\r\n    var $quick_cash = $(this);\r\n    var amt = $quick_cash\r\n      .contents()\r\n      .filter(function () {\r\n        return this.nodeType == 3;\r\n      })\r\n      .text();\r\n    var th = Settings.thousands_sep == 0 ? '' : Settings.thousands_sep;\r\n    var $pi = $('#amount');\r\n    amt = formatDecimal(amt.split(th).join('')) * 1 + $pi.val() * 1;\r\n    $pi.val(formatDecimal(amt)).change().focus();\r\n    var note_count = $quick_cash.find('span');\r\n    if (note_count.length == 0) {\r\n      $quick_cash.append('<span class=\"badge\">1</span>');\r\n    } else {\r\n      note_count.text(parseInt(note_count.text()) + 1);\r\n    }\r\n  });\r\n\r\n  $(document).on('click', '#clear-cash-notes', function () {\r\n    $('.quick-cash').find('.badge').remove();\r\n    $('#amount').val('').change().focus();\r\n  });\r\n\r\n  $('#payModal').on('change', '#amount, #paid_by', function (e) {\r\n    $('#amount_val').val($('#amount').val());\r\n  });\r\n  $('#payModal').on('blur', '#amount', function (e) {\r\n    $('#amount_val').val($('#amount').val());\r\n  });\r\n  $('#payModal').on('select2-close', '#paid_by', function (e) {\r\n    $('#paid_by_val').val($(this).val());\r\n  });\r\n  $('#payModal').on('change', '#pcc_no', function (e) {\r\n    $('#cc_no_val').val($(this).val());\r\n  });\r\n  $('#payModal').on('change', '#pcc_holder', function (e) {\r\n    $('#cc_holder_val').val($(this).val());\r\n  });\r\n  $('#payModal').on('change', '#gift_card_no', function (e) {\r\n    $('#paying_gift_card_no_val').val($(this).val());\r\n  });\r\n  $('#payModal').on('change', '#pcc_month', function (e) {\r\n    $('#cc_month_val').val($(this).val());\r\n  });\r\n  $('#payModal').on('change', '#pcc_year', function (e) {\r\n    $('#cc_year_val').val($(this).val());\r\n  });\r\n  $('#payModal').on('change', '#pcc_type', function (e) {\r\n    $('#cc_type_val').val($(this).val());\r\n  });\r\n  $('#payModal').on('change', '#pcc_cvv2', function (e) {\r\n    $('#cc_cvv2_val').val($(this).val());\r\n  });\r\n  $('#payModal').on('change', '#cheque_no', function (e) {\r\n    $('#cheque_no_val').val($(this).val());\r\n  });\r\n  $('#payModal').on('change', '#payment_note', function (e) {\r\n    $('#payment_note_val').val($(this).val());\r\n  });\r\n  $('#payModal').on('change', '#note', function (e) {\r\n    var n = $(this).val();\r\n    store('spos_note', n);\r\n    $('#spos_note').val(n);\r\n  });\r\n  if ((spos_note = get('spos_note'))) {\r\n    $('#note').val(spos_note);\r\n    $('#snote').val(spos_note);\r\n  }\r\n  $('#spos_customer').change(function (e) {\r\n    store('spos_customer', $(this).val());\r\n  });\r\n  if ((spos_customer = get('spos_customer'))) {\r\n    $('#spos_customer').select2('val', spos_customer);\r\n  }\r\n\r\n  $('.treeview').hover(function (e) {\r\n    var wh = $(document).height();\r\n    var top = $(this).offset().top;\r\n    var menu = $(this).find('.treeview-menu');\r\n    var menuh = menu.height() + 44;\r\n    if (wh - top < menuh) {\r\n      $(this).find('a').children('span').addClass('popup');\r\n      menu.addClass('popup');\r\n    } else {\r\n      $(this).find('a').children('span').removeClass('popup');\r\n      menu.removeClass('popup');\r\n    }\r\n  });\r\n\r\n  $('body').click(function (e) {\r\n    if (!$(e.target).hasClass('sidebar-icon') && !$(e.target).hasClass('sb') && $('#categories-list').hasClass('control-sidebar-open')) {\r\n      $('#categories-list').removeClass('control-sidebar-open');\r\n    }\r\n  });\r\n\r\n  //pagar\r\n  $('#submit-sale').click(function () {\r\n    for (i = 0; i < nextinput; i++) {\r\n      if( ($('#metodo_'+i).val() == \"cash\" || $('#metodo_'+i).val() == \"CC\" ) && parseFloat($(\"#cantidad_\"+i).val()) > 0){\r\n        if($('#metodo_'+i).val() == \"cash\"){\r\n          bancos[i] = null\r\n        } else {\r\n          if( $('#banco_'+i).val() != \"seleccione\"){\r\n            bancos[i] = $('#banco_'+i).val()\r\n          } else {\r\n            alert (\"Por favor, seleccione un banco\") \r\n            return;\r\n          }\r\n        }\r\n      \r\n       //bancos[i] = $('#banco_'+i).val()\r\n        metodos[i] = $('#metodo_'+i).val()\r\n        cantidad[i] = $(\"#cantidad_\"+i).val()\r\n        total_cantidad = total_cantidad + parseFloat(cantidad[i]);\r\n      } else {\r\n        alert (\"Llene correctamente los campos\", metodos[i],cantidad[i])\r\n        return;\r\n      }\r\n    }\r\n\r\n    console.log(`${total_cantidad} < ${g_total}`)\r\n    if(total_cantidad < g_total){\r\n      alert(\"El total de pagos debe ser mayor al monto a pagar\");\r\n      return;\r\n    }\r\n\r\n    $('#total_items').val(an - 1);\r\n    $('#total_quantity').val(quantityFormat(count - 1));\r\n    $('#total_pagos').val(quantityFormat(total_cantidad - 1));\r\n    $('#metodos').val(metodos);\r\n    $('#cantidad').val(cantidad);\r\n    $('#bancos').val(bancos);\r\n    $('#submit').click();\r\n    total_cantidad=0\r\n\r\n    \r\n  });\r\n\r\n  var hold_ref = $('#hold_ref').val();\r\n  $('#hold_ref').change(function () {\r\n    hold_ref = $(this).val();\r\n    $('#reference_note').val(hold_ref);\r\n  });\r\n  $('#reference_note').change(function () {\r\n    hold_ref = $(this).val();\r\n    $('#hold_ref').val(hold_ref);\r\n  });\r\n\r\n  $('#suspend_sale').click(function () {\r\n    if ($('#reference_note').val()) {\r\n      $('#hold_ref').val($('#reference_note').val());\r\n      $('#total_items').val(an - 1);\r\n      $('#total_quantity').val(quantityFormat(count - 1));\r\n      $('#submit').click();\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $('#customer-form').on('submit', function (e) {\r\n    e.preventDefault();\r\n    $.ajax({\r\n      type: 'post',\r\n      url: base_url + 'customers/add',\r\n      data: $(this).serialize(),\r\n      dataType: 'json',\r\n      success: function (res) {\r\n        if (res.status == 'success') {\r\n          $('#spos_customer').append($('<option></option>').attr('value', res.id).text(res.val));\r\n          $('#spos_customer').select2('val', res.id);\r\n          $('#customerModal').modal('hide');\r\n        } else {\r\n          $('#c-alert').html(res.msg);\r\n          $('#c-alert').show();\r\n        }\r\n      },\r\n      error: function () {\r\n        bootbox.alert(lang.customer_request_failed);\r\n        return false;\r\n      },\r\n    });\r\n    return false;\r\n  });\r\n\r\n  $('#customerModal').on('hidden.bs.modal', function (e) {\r\n    $('#c-alert').hide();\r\n    $('#cname').val('');\r\n    $('#cemail').val('');\r\n    $('#cphone').val('');\r\n    $('#cf1').val('');\r\n    $('#cf2').val('');\r\n  });\r\n});\r\n\r\nfunction display_keyboards() {\r\n  if (!jQuery.browser.mobile) {\r\n    $('.kb-text').keyboard({\r\n      autoAccept: true,\r\n      alwaysOpen: false,\r\n      openOn: 'focus',\r\n      usePreview: false,\r\n      // layout: 'qwerty',\r\n      layout: 'custom',\r\n      display: {\r\n        bksp: '\\u2190',\r\n        accept: 'return',\r\n        default: 'ABC',\r\n        meta1: '123',\r\n        meta2: '#+=',\r\n      },\r\n      customLayout: {\r\n        default: [\r\n          'q w e r t y u i o p {bksp}',\r\n          'a s d f g h j k l {enter}',\r\n          '{s} z x c v b n m , . {s}',\r\n          '{meta1} {space} {cancel} {accept}',\r\n        ],\r\n        shift: ['Q W E R T Y U I O P {bksp}', 'A S D F G H J K L {enter}', '{s} Z X C V B N M / ? {s}', '{meta1} {space} {meta1} {accept}'],\r\n        meta1: [\r\n          '1 2 3 4 5 6 7 8 9 0 {bksp}',\r\n          '- / : ; ( ) \\u20ac & @ {enter}',\r\n          '{meta2} . , ? ! \\' \" {meta2}',\r\n          '{default} {space} {default} {accept}',\r\n        ],\r\n        meta2: [\r\n          '[ ] { } # % ^ * + = {bksp}',\r\n          '_ \\\\ | &lt; &gt; $ \\u00a3 \\u00a5 {enter}',\r\n          '{meta1} ~ . , ? ! \\' \" {meta1}',\r\n          '{default} {space} {default} {accept}',\r\n        ],\r\n      },\r\n    });\r\n\r\n    $('.kb-pad').keyboard({\r\n      restrictInput: true,\r\n      preventPaste: true,\r\n      autoAccept: true,\r\n      alwaysOpen: false,\r\n      openOn: 'click',\r\n      usePreview: false,\r\n      layout: 'costom',\r\n      display: {\r\n        b: '\\u2190:Backspace',\r\n      },\r\n      customLayout: {\r\n        default: ['1 2 3 {b}', '4 5 6 . {clear}', '7 8 9 0 %', '{accept} {cancel}'],\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\nfunction calTax() {\r\n  var ts = get('spos_tax') ? get('spos_tax') : $('#tax_val').val();\r\n  if (ts.indexOf('%') !== -1) {\r\n    var pts = ts.split('%');\r\n    order_tax = ((total - order_discount) * parseFloat(pts[0])) / 100;\r\n    $('#ts_con').text(formatMoney(order_tax));\r\n  } else {\r\n    order_tax = parseFloat(ts);\r\n    $('#ts_con').text(formatMoney(order_tax));\r\n  }\r\n  return order_tax;\r\n}\r\n\r\nfunction nav_pointer() {\r\n  var pp = p_page == 'n' ? 0 : p_page;\r\n  pp == 0 ? $('#previous').attr('disabled', true) : $('#previous').attr('disabled', false);\r\n  pp + pro_limit > tcp ? $('#next').attr('disabled', true) : $('#next').attr('disabled', false);\r\n}\r\n\r\n$(document).ready(function () {\r\n  $(document).on('click', '#print-modal-close', function (e) {\r\n    $('#printModal').hide();\r\n  });\r\n});\r\nfunction Popup(data, type) {\r\n  $('#print-title').text(lang.print + ' ' + lang[type]);\r\n  $('#print-body').html(data);\r\n  $('#printModal').show();\r\n  //   createWin(data).then(function (w) {\r\n  //     w.close();\r\n  //   });\r\n}\r\nfunction createWin(data) {\r\n  return new Promise(function (resolve) {\r\n    var d =\r\n      '<!DOCTYPE html><html><head><title>Print</title><link rel=\"stylesheet\" href=\"' +\r\n      assets +\r\n      'bootstrap/css/bootstrap.min.css\" type=\"text/css\" /></head><body>' +\r\n      data +\r\n      '<script type=\"text/javascript\">window.print();</script></body></html>';\r\n    var mywindow = window.open(d, 'spos_print', 'height=500,width=300');\r\n    mywindow.document.write(d);\r\n    setTimeout(function () {\r\n      resolve(mywindow);\r\n    }, 20);\r\n  });\r\n}\r\n\r\n$(document).ready(function ($) {\r\n  window.setTimeout(function () {\r\n    $('.alerts').slideUp();\r\n  }, 15000);\r\n  $('.alerts').on('click', function (e) {\r\n    $(this).slideUp();\r\n  });\r\n  $('#list-table-div').slimScroll({ start: 'bottom' });\r\n  $('#category-sidebar-menu').slimScroll({ width: '100%' });\r\n  $('.items').slimScroll({});\r\n});\r\n\r\nfunction posScreen() {\r\n  var wh = $(window).height(),\r\n    total_dh = $('#totaldiv').height(),\r\n    buttons_dh = $('.botbuttons').height(),\r\n    left_top_dh = $('#lefttop').outerHeight();\r\n  var items_dh = wh - 120,\r\n    list_table_dh = wh - 185 - left_top_dh - total_dh - buttons_dh;\r\n  $('#right-col').height(wh - 100);\r\n  $('.items').height(items_dh > 400 ? items_dh : 400);\r\n  $('#list-table-div').height(list_table_dh);\r\n}\r\n\r\nfunction printLine(str) {\r\n  var size = parseInt(Settings.char_per_line) - 4;\r\n  var len = str.length;\r\n  var res = str.split(':');\r\n  var newd = res[0];\r\n  for (i = 1; i < size - len; i++) {\r\n    newd += ' ';\r\n  }\r\n  newd += res[1];\r\n  return newd;\r\n}\r\n\r\n$(window).bind('resize', posScreen);\r\n\r\nfunction read_card() {}\r\n\r\n$.extend($.keyboard.keyaction, {\r\n  enter: function (base) {\r\n    if (base.$el.is('textarea')) {\r\n      base.insertText('\\r\\n');\r\n    } else {\r\n      base.accept();\r\n    }\r\n  },\r\n});\r\n\r\n$(document).ready(function () {\r\n  posScreen();\r\n  if (Settings.display_kb == 1) {\r\n    display_keyboards();\r\n  }\r\n  nav_pointer();\r\n  loadItems();\r\n  read_card();\r\n\r\n  $('.swipe')\r\n    .keypress(function (e) {\r\n      var TrackData = $(this).val() ? $(this).val() : '';\r\n      if (TrackData != '') {\r\n        if (e.keyCode == 13) {\r\n          e.preventDefault();\r\n          var p = new SwipeParserObj(TrackData);\r\n\r\n          if (p.hasTrack1) {\r\n            var CardType = null;\r\n            var ccn1 = p.account.charAt(0);\r\n            if (ccn1 == 4) CardType = 'Visa';\r\n            else if (ccn1 == 5) CardType = 'MasterCard';\r\n            else if (ccn1 == 3) CardType = 'Amex';\r\n            else if (ccn1 == 6) CardType = 'Discover';\r\n            else CardType = 'Visa';\r\n\r\n            $('#pcc_no').val(p.account).change();\r\n            $('#pcc_holder').val(p.account_name).change();\r\n            $('#pcc_month').val(p.exp_month).change();\r\n            $('#pcc_year').val(p.exp_year).change();\r\n            $('#pcc_cvv2').val('');\r\n            $('#pcc_type').select2('val', CardType);\r\n          } else {\r\n            $('#pcc_no').val('').change();\r\n            $('#pcc_holder').val('').change();\r\n            $('#pcc_month').val('').change();\r\n            $('#pcc_year').val('').change();\r\n            $('#pcc_cvv2').val('').change();\r\n            $('#pcc_type').val('').change();\r\n          }\r\n\r\n          $('#pcc_cvv2').focus();\r\n        }\r\n      }\r\n    })\r\n    .blur(function (e) {\r\n      $(this).val('');\r\n    })\r\n    .focus(function (e) {\r\n      $(this).val('');\r\n    });\r\n\r\n  $(document).on('blur', '#pcc_no', function () {\r\n    var cn = $(this).val();\r\n    var ccn1 = cn.charAt(0);\r\n    if (ccn1 == 4) CardType = 'Visa';\r\n    else if (ccn1 == 5) CardType = 'MasterCard';\r\n    else if (ccn1 == 3) CardType = 'Amex';\r\n    else if (ccn1 == 6) CardType = 'Discover';\r\n    else CardType = 'Visa';\r\n\r\n    $('#pcc_type').select2('val', CardType);\r\n  });\r\n\r\n  $('.modal').on('hidden.bs.modal', function () {\r\n    $(this).removeData('bs.modal');\r\n  });\r\n  $('#clearLS').click(function (event) {\r\n    bootbox.confirm(lang.r_u_sure, function (result) {\r\n      if (result == true) {\r\n        localStorage.clear();\r\n        location.reload();\r\n      }\r\n    });\r\n    return false;\r\n  });\r\n\r\n  if (Settings.focus_add_item != '') {\r\n    shortcut.add(\r\n      Settings.focus_add_item,\r\n      function () {\r\n        $('#add_item').focus();\r\n      },\r\n      { type: 'keydown', propagate: false, target: document }\r\n    );\r\n  }\r\n  if (Settings.add_customer != '') {\r\n    shortcut.add(\r\n      Settings.add_customer,\r\n      function () {\r\n        $('#add-customer').trigger('click');\r\n      },\r\n      { type: 'keydown', propagate: false, target: document }\r\n    );\r\n  }\r\n  if (Settings.toggle_category_slider != '') {\r\n    shortcut.add(\r\n      Settings.toggle_category_slider,\r\n      function () {\r\n        $('[data-toggle=\"control-sidebar\"]').trigger('click');\r\n      },\r\n      { type: 'keydown', propagate: false, target: document }\r\n    );\r\n  }\r\n  if (Settings.cancel_sale != '') {\r\n    shortcut.add(\r\n      Settings.cancel_sale,\r\n      function () {\r\n        $('#reset').click();\r\n      },\r\n      { type: 'keydown', propagate: false, target: document }\r\n    );\r\n  }\r\n  if (Settings.suspend_sale != '') {\r\n    shortcut.add(\r\n      Settings.suspend_sale,\r\n      function () {\r\n        $('#suspend').trigger('click');\r\n      },\r\n      { type: 'keydown', propagate: false, target: document }\r\n    );\r\n  }\r\n  if (Settings.print_order != '') {\r\n    shortcut.add(\r\n      Settings.print_order,\r\n      function () {\r\n        $('#print_order').click();\r\n      },\r\n      { type: 'keydown', propagate: false, target: document }\r\n    );\r\n  }\r\n  if (Settings.print_bill != '') {\r\n    shortcut.add(\r\n      Settings.print_bill,\r\n      function () {\r\n        $('#print_bill').click();\r\n      },\r\n      { type: 'keydown', propagate: false, target: document }\r\n    );\r\n  }\r\n  if (Settings.finalize_sale != '') {\r\n    shortcut.add(\r\n      Settings.finalize_sale,\r\n      function () {\r\n        $('#payment').trigger('click');\r\n      },\r\n      { type: 'keydown', propagate: false, target: document }\r\n    );\r\n  }\r\n  if (Settings.today_sale != '') {\r\n    shortcut.add(\r\n      Settings.today_sale,\r\n      function () {\r\n        $('#today_sale').click();\r\n      },\r\n      { type: 'keydown', propagate: false, target: document }\r\n    );\r\n  }\r\n  if (Settings.open_hold_bills != '') {\r\n    shortcut.add(\r\n      Settings.open_hold_bills,\r\n      function () {\r\n        $('#opened_bills').trigger('click');\r\n      },\r\n      { type: 'keydown', propagate: false, target: document }\r\n    );\r\n  }\r\n  if (Settings.close_register != '') {\r\n    shortcut.add(\r\n      Settings.close_register,\r\n      function () {\r\n        $('#close_register').click();\r\n      },\r\n      { type: 'keydown', propagate: false, target: document }\r\n    );\r\n  }\r\n});\r\n$.fn.focusToEnd = function () {\r\n  return this.each(function () {\r\n    var v = $(this).val();\r\n    $(this).focus().val('').val(v);\r\n  });\r\n};\r\n$.ajaxSetup({ cache: false, headers: { 'cache-control': 'no-cache' } });\r\n"]}